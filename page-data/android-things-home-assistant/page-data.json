{"componentChunkName":"component---src-templates-blog-template-js","path":"/android-things-home-assistant","result":{"data":{"site":{"siteMetadata":{"title":"mnkytypwrtr"}},"markdownRemark":{"html":"<p>After playing around with Android Things for the <a href=\"/android-things-blinky\">first time</a>, I’ve decided to explore the APIs and try out all the other cool things you could do with this platform. Though blinking an LED was only fun for about 5.2 seconds, that accomplishment prepared me with knowledge to tackle some of the more advanced projects. There are quite a few examples on GitHub, ranging from toggling <a href=\"https://github.com/androidthings/sample-simplepio\">GPIOs</a>, <a href=\"https://github.com/androidthings/sample-bluetooth-audio\">Bluetooth audio</a>, and even one on <a href=\"https://github.com/androidthings/sample-tensorflow-imageclassifier\">TensorFlow</a>.</p>\n<p>At around the same time, Google announced their <a href=\"https://aiyprojects.withgoogle.com/\">AIY Voice Kit</a>: a DIY AI assistant using a Raspberry Pi. I got super excited and couldn’t wait to build one myself; it looked like a fun little project, and I’ve always wanted to compare Google’s experience with the Amazon Echo’s.</p>\n<p><figure class=\"md-figure\"><img src=\"/assets/2017-07-08-android-things-home-assistant/aiy-kit.png\"><figcaption>The kit came bundled with issue #57 of The MagPi</figcaption></figure></p>\n<p>Much to my dismay, the kits were sold out everywhere, and scalpers were selling them for upwards of $90 on eBay :(</p>\n<p><figure class=\"md-figure\"><img src=\"/assets/2017-07-08-android-things-home-assistant/magpi.png\"><figcaption>Me: Sad</figcaption></figure></p>\n<p>The kit was essentially a cardboard box with a Voice HAT that connects the button, speaker, and microphones to the Raspberry Pi; the magic was within the <a href=\"https://developers.google.com/assistant/sdk/overview\">Google Assistant SDK</a>, which provides the APIs for the voice-based AI interactions.</p>\n<p>Luckily for me, the Google Assistant APIs are supported on Android Things! Would it work on the Edison?</p>\n<p><figure class=\"md-figure\"><img src=\"/assets/2017-07-08-android-things-home-assistant/edison-whats-the-weather.gif\"><figcaption>The LED on pin 13 blinks when playing an audio response</figcaption></figure></p>\n<p><figure class=\"md-figure\"><img src=\"/assets/2017-07-08-android-things-home-assistant/speech-to-text-log.png\"><figcaption>speech-to-text captured in the logs</figcaption></figure></p>\n<p>It works! Now let’s see how to put it together…</p>\n<h2>Things You’ll Need</h2>\n<ul>\n<li>Intel Edison with Arduino Breakout (though any Android Things supported device should work)</li>\n<li><a href=\"https://www.ebay.com/b/External-Sound-Cards/75518\">USB sound card with mic input</a> (not needed if your board has audio jacks for in/out)</li>\n<li>Speakers (I used my headphones because I don’t have any handy)</li>\n<li><a href=\"https://www.ebay.com/b/Lavalier-Pro-Audio-Microphones/29946\">Microphone</a></li>\n<li>Arduino Shield + Button (you could also wire a momentary switch directly to a GPIO pin)</li>\n</ul>\n<p><figure class=\"md-figure\"><img src=\"/assets/2017-07-08-android-things-home-assistant/edison-connected.jpg\"><figcaption>The button is connected to IO4</figcaption></figure></p>\n<h2>Running Google Assistant on Android Things</h2>\n<p>The first thing you’ll need to do is to flash Android Things onto your device, you can follow my <a href=\"/android-things-blinky\">previous article</a> or use the <a href=\"https://developer.android.com/things/hardware/edison.html\">official guide</a>. It might be a good idea to at least get to blinky first, so you know that you have a functioning Android Things device.</p>\n<p>Once that’s done, you can then open the Google Assistant sample in Android Studio. You can find the sample code <a href=\"https://github.com/w4ilun/sample-googleassistant\">here</a>, which I forked from the <a href=\"https://github.com/androidthings/sample-googleassistant\">official repo</a>; I’ve made some minor changes to make it work with my setup, namely:</p>\n<ul>\n<li>Changed the button to activate on high instead of low</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Button</span><span class=\"token punctuation\">.</span><span class=\"token class-name\">LogicState</span><span class=\"token punctuation\">.</span>PRESSED_WHEN_HIGH</code></pre></div>\n<br>\n<ul>\n<li>Mapped button to IO4 (in BoardDefaults.java)</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">String</span> <span class=\"token function\">getGPIOForButton</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span><span class=\"token function\">getBoardVariant</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> DEVICE_EDISON_ARDUINO<span class=\"token operator\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token string\">\"IO4\"</span><span class=\"token punctuation\">;</span></code></pre></div>\n<br>\n<ul>\n<li>Default to USB sound card instead of the Voice HAT for the Raspberry Pi</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">AUDIO_USE_I2S_VOICEHAT_IF_AVAILABLE <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span></code></pre></div>\n<br>\n<p><figure class=\"md-figure\"><img src=\"/assets/2017-07-08-android-things-home-assistant/android-studio.png\"><figcaption>I’m using Android Studio 2.3.2</figcaption></figure></p>\n<p>Before you build and deploy onto the device, you’ll also need setup your credentials so your device can use the Google Assistant APIs, and grant permissions via Oauth:</p>\n<ul>\n<li>Follow the instructions <a href=\"https://developers.google.com/assistant/sdk/prototype/getting-started-other-platforms/config-dev-project-and-account\">here</a> to enable Google Assistant APIs and get your client secret JSON file. You can then rename that file to <strong>client<em>secret</em>NNNN.json</strong> to keep it short (if you want to). I also found this <a href=\"https://aiyprojects.withgoogle.com/voice/#users-guide-1-2--turn-on-the-google-assistant-api\">guide</a> pretty useful</li>\n<li>Copy that file over to your projects root directory, then run Google’s oauthlib tool to generate the credentials.json</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">pip install google-auth-oauthlib[tool]\ngoogle-oauthlib-tool --client-secrets client_secret_NNNN.json \\\n                     --credentials app/src/main/res/raw/credentials.json \\\n                     --scope https://www.googleapis.com/auth/assistant-sdk-prototype \\\n                     --save</code></pre></div>\n<br>\n<p>All set! Now click run let the app build and deploy. It should build successfully and you’ll be greeted with:</p>\n<p><figure class=\"md-figure\"><img src=\"/assets/2017-07-08-android-things-home-assistant/android-studio-logcat.png\"><figcaption>woohoo</figcaption></figure></p>\n<p>Yay! Except nothing works, because the USB sound card is not connected…what?!</p>\n<p>The Edison Arduino breakout board is setup in a way that there’s a tiny toggle switch between the larger USB-A port and the micro USB port. You can only use one or the other, by moving the toggle switch. Which means you can <strong>either</strong> use the micro USB port for the ADB shell connection to deploy and debug your application, <strong>or</strong> you can switch and use the larger USB host port for your sound card, <strong>but not both at the same time :(</strong></p>\n<p>Thankfully, the solution is simple: you’ll need to connect a 12V power supply so you can keep the USB host port active for the sound card (i.e. tiny toggle switch facing up). However, you’ll lose the micro USB connection and need to use <a href=\"https://stackoverflow.com/questions/4893953/run-install-debug-android-applications-over-wi-fi\">ADB shell over Wi-Fi</a> instead:</p>\n<div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">$ adb tcpip 5555\n$ adb connect &lt;DEVICE_IP_ADDRESS&gt;:5555\n$ adb shell</code></pre></div>\n<br>\n<p>Now deploy and run your application again. Your device will start listening when you press the button, and stop when you release it. Your voice query gets sent over via the Google Assistant API, and you get a response almost instantaneously. Neat! Since the service is linked to your Google account, you can even tell it to add events to your Calendar and access other information. Ask for a joke, find out tomorrow’s weather, and when you run out of ideas, check out this <a href=\"http://www.androidauthority.com/google-home-commands-727911/\">comprehensive list</a>.</p>\n<br>\n<hr>\n<br>\n<p>Well, that’s it. Again, this has been a lot of fun and it’s great to see how easy it is these days to sprinkle some AI into any project. I still haven’t fully explored the capabilities of my DIY Google Assistant yet, but I think there’s a lot of potential for interesting projects here. I’d love to find out if it can control other IoT products as well, perhaps a <a href=\"/amazon-echo-iot-switch-esp8266\">spoofed WeMo switch</a>? :)</p>","frontmatter":{"date":"July 08, 2017","path":"/android-things-home-assistant","title":"Build a Google Home assistant with Android Things","thumbnail":"/assets/2017-07-08-android-things-home-assistant/thumbnail.png","metaDescription":"Build a Google Home assistant with Android Things"}}},"pageContext":{}}}